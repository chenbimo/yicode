# æ’ä»¶

æ’ä»¶æ˜¯ `yite-cli` è„šæ‰‹æ¶ç‰¹æœ‰çš„å†…å®¹ï¼Œä¹Ÿæ˜¯ `çº¦å®š` çš„ä¸€éƒ¨åˆ†ã€‚

æ’ä»¶ç›®å½•ä½äº `src/plugins` ç›®å½•ä¸‹ã€‚

é»˜è®¤çš„æ’ä»¶å†…å®¹å¦‚ä¸‹ï¼š

```bash
â””â”€â”€â”€ğŸ“ src/
    â””â”€â”€â”€ğŸ“ plugins/
        â”œâ”€â”€â”€ğŸ“„ http.js
        â”œâ”€â”€â”€ğŸ“„ i18n.js
        â”œâ”€â”€â”€ğŸ“„ router.js
        â””â”€â”€â”€ğŸ“„ storage.js
```

å…¶å«ä¹‰å’Œä½œç”¨å¦‚ä¸‹ï¼š

-   `http.js` æ¥å£è¯·æ±‚æ’ä»¶
-   `i18n.js` å¤šè¯­è¨€å›½é™…åŒ–æ’ä»¶
-   `router.js` è‡ªåŠ¨è·¯ç”±æ’ä»¶
-   `storage.js` æµè§ˆå™¨å­˜å‚¨æ’ä»¶

è¿˜è®°å¾—å‰æ–‡æåˆ°çš„ï¼Œé¡µé¢ç»“æ„å³è·¯ç”±å—ï¼Œå°±æ˜¯ç”± `route.js` æ’ä»¶æä¾›çš„ã€‚

æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ `route.js` æ–‡ä»¶çš„å†…å®¹ï¼š

```javascript
import { yiteRoutes } from 'virtual:yite-router';

// åˆ›å»ºè·¯ç”±
let $Router = createRouter({
    routes: yiteRoutes(),
    history: createWebHashHistory()
});

export { $Router };
```

æ²¡é”™ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ï¼

å†…éƒ¨çš„ä»£ç ç»†èŠ‚ï¼Œå·²ç»è¢«ç¬”è€…æ”¾åˆ°äº†ç‹¬ç«‹çš„ `yite-router` æ¨¡å—ä¸­ã€‚

æœ€è‹¦ã€æœ€ç´¯ã€æœ€éº»çƒ¦çš„é—®é¢˜ï¼Œäº¤ç»™ç¬”è€…ã€‚

æœ€å¥½ã€æœ€å¼ºã€æœ€æ–¹ä¾¿çš„åŠŸèƒ½ï¼Œç•™ç»™ä½ ä»¬ã€‚

å¼€å‘é¡¹ç›®ï¼Œåº”è¯¥å‡å°‘ï¼Œç”šè‡³é¿å…å»æ€è€ƒé¡¹ç›®æ¶æ„æ–¹é¢çš„é—®é¢˜ã€‚

è€Œæ˜¯ä¸“æ³¨äºä¸šåŠ¡å¼€å‘ï¼Œç”¨æœ€å¿«ã€æœ€å¥½ã€æœ€ç¨³å®šçš„æ–¹å¼ï¼Œå®Œæˆé¡¹ç›®ï¼Œå‘å¸ƒä¸Šçº¿ã€‚

## ä½¿ç”¨æ’ä»¶

æ’ä»¶ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå…¨éƒ¨ç”± `yite-cli` è‡ªåŠ¨å¯¼å…¥ï¼Œå…¨å±€å¯ç”¨ã€‚

ä»¥ `http.js` æ’ä»¶ä¸ºä¾‹ï¼Œæˆ‘ä»¬çœ‹çœ‹å®ƒå¦‚ä½•ä½¿ç”¨ï¼Œå…ˆçœ‹å…¶å®šä¹‰

```javascript
import axios from 'axios';

let $Http = axios.create({
    method: 'POST',
    baseURL: import.meta.env.VITE_HOST,
    timeout: 1000 * 60,
    withCredentials: false,
    responseType: 'json',
    responseEncoding: 'utf8',
    headers: {}
});
// æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨
$Http.interceptors.request.use(
    function (config) {
        let token = $Storage.local.get('token');
        if (token) {
            config.headers.authorization = 'Bearer ' + token;
        }
        return config;
    },
    function (error) {
        return Promise.reject(error);
    }
);

// æ·»åŠ å“åº”æ‹¦æˆªå™¨
$Http.interceptors.response.use(
    function (res) {
        if (res.data.code === 0) {
            return Promise.resolve(res.data);
        }
        if (res.data.symbol === 'NOT_LOGIN') {
            location.href = location.origin + '/#/login';
        }
        return Promise.reject(res.data);
    },
    function (error) {
        return Promise.reject(res.data);
    }
);
export { $Http };
```

å¯ä»¥çœ‹åˆ°ï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„ `axios` å°è£…ï¼ŒåŒæ—¶å¯¼å‡ºäº† `$Http` è¯·æ±‚å®ä¾‹ã€‚

ä½¿ç”¨çš„æ—¶å€™ï¼Œä¸éœ€è¦å†™å¦‚ä¸‹å¯¼å…¥ä»£ç ï¼š

```javascript
import { $Http } from '@/plugins/https.js';
```

ç›´æ¥ä½¿ç”¨å³å¯ï¼Œå› ä¸ºæ‰€æœ‰çš„æ’ä»¶ï¼Œéƒ½ä¼šè¢« `yite-cli` é»˜è®¤å¯¼å…¥ï¼Œå…¨å±€å¯ç”¨ã€‚

```vue
<script setup>
// é€‰é¡¹é›†
defineOptions({
    name: 'feedback'
});

// å…¨å±€é›†
let { $GlobalData, $GlobalComputed, $GlobalMethod } = useGlobal();

// å·¥å…·é›†

// æ•°æ®é›†
let $Data = $ref({
    pagination: {
        page: 1,
        limit: 20,
        total: 0
    },
    tableData: []
});

// æ–¹æ³•é›†
let $Method = {
    async initData() {
        await $Method.apiSelectData();
    },
    // æŸ¥è¯¢ç”¨æˆ·æ•°æ®
    async apiSelectData() {
        try {
            let res = await $Http({
                url: '/feedback/select',
                data: {
                    page: $Data.pagination.page,
                    limit: $Data.pagination.limit
                }
            });
            $Data.tableData = res.data.rows;
            $Data.pagination.total = res.data.total;
        } catch (err) {
            console.log(err);
        }
    }
};

$Method.initData();
</script>
```

## è‡ªå®šä¹‰æ’ä»¶

å¦‚æœéœ€è¦è‡ªå·±å®šä¹‰æ–°çš„æ’ä»¶ï¼Œåªéœ€è¦åœ¨ `src/plugins` ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª `js` æ–‡ä»¶ï¼Œå†™ä¸Šè‡ªå·±çš„ä»£ç å³å¯ã€‚

å¦‚æœæ–‡ä»¶åŒ…å«äº†å¯¼å‡ºçš„å˜é‡ï¼Œé‚£ä¹ˆæ­¤å˜é‡å°†åœ¨å…¨å±€å¯ç”¨ï¼Œæ— éœ€å¯¼å…¥ã€‚
